import{_ as s,c as n,o as a,a as l}from"./app.721b1925.js";const C=JSON.parse('{"title":"Scrapy Redis \u5206\u5E03\u5F0F\u722C\u866B","description":"","frontmatter":{},"headers":[],"relativePath":"guide/components/scrapy-redis.md","lastUpdated":1659367147000}'),p={name:"guide/components/scrapy-redis.md"},o=l(`<h1 id="scrapy-redis-\u5206\u5E03\u5F0F\u722C\u866B" tabindex="-1">Scrapy Redis \u5206\u5E03\u5F0F\u722C\u866B <a class="header-anchor" href="#scrapy-redis-\u5206\u5E03\u5F0F\u722C\u866B" aria-hidden="true">#</a></h1><p>\u5206\u5E03\u5F0F\u722C\u866B\u7F16\u5199\u4E4B\u524D\u5E94\u8BE5\u5B58\u5728\u666E\u901A\u722C\u866B\u3002\u901A\u8FC7\u4E0B\u9762\u7684\u6B65\u9AA4\u53EF\u4EE5\u5C06\u666E\u901A\u722C\u866B\u7F16\u5199\u4E3A\u5206\u5E03\u5F0F\u722C\u866B\u3002</p><p>\u53EF\u4EE5\u53C2\u8003 <a href="https://github.com/curder/scrapy-study/blob/master/examples/dangdang.com/README.md" target="_blank" rel="noopener noreferrer">\u8FD9\u4E2A\u9879\u76EE</a> \u7684 <a href="https://github.com/curder/scrapy-study/blob/master/examples/dangdang.com/dangdang/spiders/book.py" target="_blank" rel="noopener noreferrer">\u666E\u901A\u722C\u866B</a> \u548C \u7ECF\u8FC7\u6539\u9020\u540E\u7684 <a href="https://github.com/curder/scrapy-study/blob/master/examples/dangdang.com/dangdang/spiders/book_redis.py" target="_blank" rel="noopener noreferrer">\u5206\u5E03\u5F0F\u722C\u866B</a>\u3002</p><ol><li>\u5728\u8718\u86DB\u6587\u4EF6\u5BFC\u5165 <code>RedisSpider</code> \u722C\u866B\u7C7B</li><li>\u81EA\u5B9A\u4E49\u8718\u86DB\u6587\u4EF6\u7EE7\u627F\u81EA <code>RedisSpider</code> \u722C\u866B\u7C7B</li><li>\u6CE8\u9500\u722C\u866B\u7C7B\u4E2D <code>allowed_domains</code> \u548C <code>start_urls</code> \u5C5E\u6027\u914D\u7F6E</li><li>\u722C\u866B\u7C7B\u4E2D\u8BBE\u7F6E <code>redis_key</code> \u503C</li><li>\u8BBE\u7F6E\u722C\u866B\u7C7B\u4E2D <code>__ini__</code> \u65B9\u6CD5<div class="language-python"><span class="copy"></span><pre><code><span class="line"><span style="color:#676E95;font-style:italic;"># 1. \u5BFC\u5165 RedisSpider \u722C\u866B\u7C7B</span></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">from</span><span style="color:#A6ACCD;"> scrapy_redis</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">spiders </span><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> RedisSpider</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">class</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">BookSpider</span><span style="color:#89DDFF;">(</span><span style="color:#FFCB6B;">RedisSpider</span><span style="color:#89DDFF;">):</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;"># 2. \u7EE7\u627F\u81EARedisSpider \u722C\u866B\u7C7B</span></span>
<span class="line"><span style="color:#A6ACCD;">     name </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">book</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">  </span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#676E95;font-style:italic;"># 3. \u6CE8\u9500\u722C\u866B\u7C7B\u4E2D \`allowed_domains\` \u548C \`start_urls\` \u5C5E\u6027\u914D\u7F6E</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#676E95;font-style:italic;"># allowed_domains = [&#39;dangdang.com&#39;]</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#676E95;font-style:italic;"># start_urls = [&#39;https://category.dangdang.com/&#39;]</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#676E95;font-style:italic;"># 4. \u722C\u866B\u7C7B\u4E2D\u8BBE\u7F6E \`redis_key\` \u503C </span></span>
<span class="line"><span style="color:#A6ACCD;">     redis_key </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">book:start_urls</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#676E95;font-style:italic;"># 5. \u8BBE\u7F6E\u722C\u866B\u7C7B\u4E2D \`__ini__\` \u65B9\u6CD5</span></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#C792EA;">def</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">__init__</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">*</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">**</span><span style="color:#A6ACCD;">kwargs</span><span style="color:#89DDFF;">):</span></span>
<span class="line"><span style="color:#A6ACCD;">         </span><span style="color:#676E95;font-style:italic;"># Dynamically define the allowed domains list.</span></span>
<span class="line"><span style="color:#A6ACCD;">         domain </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> kwargs</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">pop</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">domain</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#89DDFF;">)</span></span>
<span class="line"><span style="color:#A6ACCD;">         self</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">allowed_domains</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">filter</span><span style="color:#89DDFF;">(None,</span><span style="color:#82AAFF;"> domain</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">split</span><span style="color:#89DDFF;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">,</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">))</span></span>
<span class="line"><span style="color:#A6ACCD;">         </span><span style="color:#FFCB6B;">super</span><span style="color:#89DDFF;">(</span><span style="color:#82AAFF;">BookSpider</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#A6ACCD;">self</span><span style="color:#89DDFF;">).</span><span style="color:#82AAFF;">__init__</span><span style="color:#89DDFF;">(*</span><span style="color:#82AAFF;">args</span><span style="color:#89DDFF;">,</span><span style="color:#82AAFF;"> </span><span style="color:#89DDFF;">**</span><span style="color:#82AAFF;">kwargs</span><span style="color:#89DDFF;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">     </span><span style="color:#676E95;font-style:italic;"># ...</span></span>
<span class="line"></span></code></pre></div></li><li>\u914D\u7F6E\u9879\u76EE\u81EA\u5B9A\u4E49\u914D\u7F6E<div class="language-python"><span class="copy"></span><pre><code><span class="line"><span style="color:#89DDFF;font-style:italic;">import</span><span style="color:#A6ACCD;"> logging</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># \u9879\u76EE\u81EA\u5B9A\u4E49\u914D\u7F6E</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">USER_AGENT </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">\\</span></span>
<span class="line"><span style="color:#A6ACCD;">             </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">AppleWebKit/537.36 (KHTML, like Gecko) Chrome/103.0.0.0 Safari/537.36</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># \u8BBE\u7F6E\u91CD\u590D\u8FC7\u6EE4\u6A21\u5757</span></span>
<span class="line"><span style="color:#A6ACCD;">DUPEFILTER_CLASS </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">scrapy_redis.dupefilter.RFPDupeFilter</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># \u8BBE\u7F6E\u8C03\u5EA6\u5668\uFF0Cscrapy_redis\u4E2D\u7684\u8C03\u5EA6\u5668\u5177\u5907\u548C\u6570\u636E\u5E93\u4EA4\u4E92\u7684\u529F\u80FD</span></span>
<span class="line"><span style="color:#A6ACCD;">SCHEDULER </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">scrapy_redis.scheduler.Scheduler</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># \u8BBE\u7F6E\u5F53\u722C\u866B\u7ED3\u675F\u65F6\u662F\u5426\u4FDD\u5B58 Redis \u6570\u636E\u5E93\u4E2D\u662F\u5426\u53BB\u91CD\u96C6\u5408\u4E0E\u4EFB\u52A1\u961F\u5217</span></span>
<span class="line"><span style="color:#A6ACCD;">SCHEDULER_PERSIST </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">True</span></span>
<span class="line"><span style="color:#A6ACCD;">ITEM_PIPELINES </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># &#39;dangdang.pipelines.ScrapyRedisExamplePipeline&#39;: 300,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#676E95;font-style:italic;"># \u5F53\u5F00\u542F\u8BE5\u7BA1\u9053\uFF0C\u8BE5\u7BA1\u9053\u4F1A\u5C06\u6570\u636E\u5B58\u50A8\u5230 Redis \u6570\u636E\u5E93\u4E2D</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">scrapy_redis.pipelines.RedisPipeline</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">400</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># \u65E5\u5FD7\u7EA7\u522B</span></span>
<span class="line"><span style="color:#A6ACCD;">LOG_LEVEL </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> logging</span><span style="color:#89DDFF;">.</span><span style="color:#F07178;">DEBUG</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># \u5F15\u5165\u4EBA\u5DE5\u5EF6\u8FDF\u4EE5\u5229\u7528\u5E76\u884C\u6027\u3002\u52A0\u5FEB\u722C\u884C\u901F\u5EA6</span></span>
<span class="line"><span style="color:#A6ACCD;">DOWNLOAD_DELAY </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># \u9879\u76EE\u7BA1\u9053\u5E8F\u5217\u5316\u5E76\u5B58\u50A8\u6B64redis\u5BC6\u94A5\u4E2D\u7684\u9879\u76EE\u3002</span></span>
<span class="line"><span style="color:#A6ACCD;">REDIS_ITEMS_KEY </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">%(spider)s:items</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># \u9ED8\u8BA4\u60C5\u51B5\u4E0B\uFF0Citems\u5E8F\u5217\u5316\u5668\u662FScrapyJSONEncoder\u3002\u60A8\u53EF\u4EE5\u4F7F\u7528\u6307\u5411\u53EF\u8C03\u7528\u5BF9\u8C61\u7684\u4EFB\u4F55\u53EF\u5BFC\u5165\u8DEF\u5F84\u3002</span></span>
<span class="line"><span style="color:#A6ACCD;">REDIS_ITEMS_SERIALIZER </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">json.dumps</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># \u6307\u5B9A\u8FDE\u63A5\u5230Redis\u65F6\u8981\u4F7F\u7528\u7684\u4E3B\u673A\u548C\u7AEF\u53E3\uFF08\u53EF\u9009\uFF09\u3002</span></span>
<span class="line"><span style="color:#A6ACCD;">REDIS_HOST </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">localhost</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#A6ACCD;">REDIS_PORT </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">6379</span></span>
<span class="line"><span style="color:#A6ACCD;">REDIS_DB </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">15</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;"># \u66F4\u591ARedis\u76F8\u5173\u8BBE\u7F6E\u67E5\u770B\u8FD9\u91CC\uFF1Ahttps://github.com/rmax/scrapy-redis/wiki/Usage</span></span>
<span class="line"></span></code></pre></div></li></ol>`,4),e=[o];function t(c,r,y,D,i,F){return a(),n("div",null,e)}var d=s(p,[["render",t]]);export{C as __pageData,d as default};
